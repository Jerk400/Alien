PREFIX=@prefix@

.PHONY: test 

default:

install:
	@mkdir -p $(PREFIX)
	@for dir in test;\
	do\
          tar cf - `find $$dir -type f -print -o -type l -print | grep -v CVS ; ` | ( cd $(PREFIX); tar xf - ) ;\
	done
	cp Makefile $(PREFIX)/test

distbin:
	mkdir -p @destdir@/@glite_prefix@
	env PREFIX=@destdir@/@glite_prefix@ make install

distclean: 
	rm -rf Makefile opt configure config.* *~ aclocal.m4 autom4te.cache reports opt install-sh  ltmain.sh  missing  mkinstalldirs

test: test-cert test-new_vo test-user_tests test-performance test-gapi
	echo "Tests finished"

test-cert:
	@echo "Testing create certificates"
	[ -d test ] && cd test ; ./Install.sh -create_cert

test-new_vo:
	@echo "Testing new_vo"
	[ -d test ] && cd test ; ./Install.sh -new_vo

test-user_tests:
	@echo "Running user tests"
	[ -d test ] && cd test ; ./Install.sh -user_tests -no_break -expected 97,08,20,142,55,178,302,303

test-performance:
	@echo "Running the performance tests"
	[ -d test ] && cd test ; ./Install.sh -performance_tests -apmon

test-gapi:
	@echo "Testing gapi"
	[ -d test ] && cd test ; ./Install.sh -gapi_tests -no_break -expected 632,633,631,501,502,600,600,601,602,603,610,620,621,622,23,624,630

